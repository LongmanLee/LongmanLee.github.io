# SHVC解码器阅读记录
* 目的：为我的练手[项目](https://github.com/LongmanLee/lmApp)做准备。
* 对象：SHVC的[参考平台SHM12.1](https://hevc.hhi.fraunhofer.de/svn/svn_SHVCSoftware/tags/SHM-12.1/)解码器
* H.265语法描述符号:
  - ae(v)：基于上下文自适应二元算术编码
  - b(8)：读进连续8bit
  - f(n)：读进连续nbit
  - se(v)：有符号指数Golomb熵编码
  - u(n)：读进连续nbit，解码后的值为无符号整数
  - ue(n)：无符号指数Golamb熵编码
  - 括号中是n表示定长编码，v表示变长编码。

***

## 初步阅读
### NALUnit类
<dl>
<dt>NALUnit</dt>
<dd>封装NALUnit所有的头和负载</dd>
</dl>



* NALUnit头部结构如下
图1 
![](../image/NalUintHeader.png)

 ``` c++
struct NALUnit
{
  NalUnitType m_nalUnitType; ///< NALUnit的类型
  UInt        m_temporalId;  ///< 时域分层Id
  UInt        m_nuhLayerId;  ///< 层级Id
  ...//提供返回类型方法;
}
```

1. 每个NALU包含头部（header）和载荷(payload)
  - 头部2byte长度,第0位表 _0禁位_，通常为0， 第1-6位表 _类型_等，其他图1中表示。
  - 载荷整数字节长度。
2. _0x00 00 01_ 为NALU起始码，_0x00 00 00_ 为结束码。载荷中出现的 _0x00 00 00_ 、_0x00 00 01_ 、_0x00 00 02_ 和 _0x00 00 03_ 均在第二个 _0x00_ 后插入 _0x03_，同时，载荷最后字节为 _0x00_ 时，也插入0x03
3. 类型：[NALUnit_type.cpp](../source_code/NALUnit_type.cpp)
  - 32：VPS
  - 33：SPS
  - 34：PPS
  - 39、 40：SEI,补充增强信息
  - ...
### InputNALUnit类和TComInputBitstream 类

<dl>
<dt>InputNALUnit</dt>
<dd>继承NALUnit类，封装了一个TComInputBitstream 类</dd>
</dl>

<dl>
<dt>TComInputBitstream </dt>
<dd>从流文件中读取整个NALUnit的比特</dd>
</dl>
...

### decode函数

* 解码NalUnit函数主要有以下几个：

xDecodeSPS(),xDecodeVPS(),xDecodePPS()以及xDecodeSlice()

